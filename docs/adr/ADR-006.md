# Development Environment and Tooling Setup

## Status

Proposed

## Context

Establishes development environment and tooling for Blazor WebAssembly migration, building on existing project structure and following the decisions in ADR-002 through ADR-005.

## Decision

### Project Structure Integration

**Existing Structure (Preserved):**
```
src/
├── Client/
│   ├── AudiSense.Client.Shared/           # Enhanced for cross-platform
│   └── Platforms/
│       └── WPF/                           # Existing WPF projects
├── Server/                                # Unchanged - API ready
│   ├── AudiSense.Api/
│   ├── AudiSense.Application/
│   └── AudiSense.Infrastructure/
└── Shared/                                # Unchanged - fully reusable
    ├── AudiSense.Contracts/
    └── AudiSense.Domain/
```

**New Addition:**
```
src/Client/Platforms/Blazor/
└── AudiSense.Client.Blazor/               # New Blazor WebAssembly project
```

### Blazor Project Configuration

**AudiSense.Client.Blazor.csproj:**
```xml
<Project Sdk="Microsoft.NET.Sdk.BlazorWebAssembly">
  <PropertyGroup>
    <TargetFramework>net9.0</TargetFramework>
    <RunAOTCompilation>true</RunAOTCompilation>
    <BlazorWebAssemblyLoadAllGlobalizationData>false</BlazorWebAssemblyLoadAllGlobalizationData>
  </PropertyGroup>
  
  <ItemGroup>
    <ProjectReference Include="../../../Shared/AudiSense.Contracts/AudiSense.Contracts.csproj" />
    <ProjectReference Include="../../../Shared/AudiSense.Domain/AudiSense.Domain.csproj" />
    <ProjectReference Include="../../AudiSense.Client.Shared/AudiSense.Client.Shared.csproj" />
  </ItemGroup>
</Project>
```

### Service Registration Setup

**Program.cs:**
```csharp
var builder = WebAssemblyHostBuilder.CreateDefault(args);
builder.RootComponents.Add<App>("#app");

// Reuse existing service interfaces from Client.Shared
builder.Services.AddScoped<IDataService, HttpDataService>();
builder.Services.AddScoped<StateService>();
// Note: NavigationManager is built-in to Blazor - no registration needed

// HTTP client for API communication
builder.Services.AddHttpClient("AudiSenseApi", client =>
{
    client.BaseAddress = new Uri("https://localhost:7000/");
});

await builder.Build().RunAsync();
```

### Build Pipeline Configuration

**AOT Compilation:**
- Enable for production builds via `RunAOTCompilation`
- Configure trimming for reduced bundle size
- Implement component lazy loading

**Solution File Update:**
Add new project to existing `AudiSense.sln`

### Development Tools

**IDE Configuration:**
- Visual Studio 2022 with Blazor templates
- Hot reload enabled for rapid development
- Existing solution debugging support

**Launch Settings:**
```json
{
  "profiles": {
    "BlazorWebAssembly": {
      "commandName": "Project",
      "launchBrowser": true,
      "applicationUrl": "https://localhost:7001;http://localhost:5001",
      "environmentVariables": {
        "ASPNETCORE_ENVIRONMENT": "Development"
      }
    }
  }
}
```

### Testing Setup

**Component Testing:**
- Add `AudiSense.Client.Blazor.Tests` project
- Use bUnit framework for Blazor component testing
- Leverage existing service interfaces for mocking

## Consequences

**Benefits:**
- Minimal disruption to existing architecture
- Reuses established project patterns
- Maintains existing API and domain layers
- Enables parallel WPF/Blazor development

**Implementation:**
- Add single new Blazor project to existing structure
- Update solution file with new project reference
- Configure build pipeline for WebAssembly deployment

**Prerequisites:**
- .NET 9 SDK (already in use)
- Visual Studio 2022 (current development environment)
- Existing API endpoints functional

---

* Approved by: [name] on [date]
* Supersedes: [ADR-NUMBER] (optional)
* Superseded by: [ADR-NUMBER] (optional)
